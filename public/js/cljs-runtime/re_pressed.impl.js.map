{"version":3,"sources":["re_pressed/impl.cljs"],"mappings":"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","names":["re-pressed.impl/ns-root","re-pressed.impl/max-record","re-pressed.impl/modifier-keys","re-pressed.impl/->ns-keyword","event-type","re_pressed$impl$__GT_ns_keyword_$_ns_keyword","suffix","cljs.core.keyword","re-pressed.impl/is-key?","recent-key","key-map","cljs.core/every?","p__26396","vec__26397","cljs.core.nth","k","v","cljs.core._EQ_","cljs.core.get","re-pressed.impl/register-subs","ns-keyword","G__26402","G__26403","re-frame.core/reg-sub","db","_","cljs.core.get_in","G__26404","G__26405","G__26406","G__26407","G__26408","G__26409","G__26414","G__26415","re-pressed.impl/->set-key!","p__26422","p__26423","map__26424","cljs.core/--destructure-map","vec__26425","cljs.core.update_in","key-maps","keys","cljs.core.conj","or__5045__auto__","cljs.core.into","cljs.core/take-last","re-pressed.impl/->clear-keys!","p__26430","p__26431","map__26433","vec__26435","cljs.core/assoc-in","p__26439","vec__26440","re-pressed.impl/prevent-default-keys!","e","re-pressed.impl/register-events","re_frame.core.reg_event_fx","re-pressed.impl/register-effects","G__26443","G__26444","re-frame.core/reg-fx","G__26450","G__26451","p__26452","map__26453","goog.events/listen","js/document","cljs.core/deref","e-key","modifier-key?","tag-name","entering-input?","cljs.core/contains?","hit-key","always-listen-keys","G__26454","re-frame.core/subscribe","always-listen?","p1__26445#","cljs.core/some","cljs.core/not","G__26455","re-frame.core/dispatch-sync","vec__26457","recent-keys","G__26460","event-keys","G__26461","clear-keys","G__26462","cljs.core/last","is-key-sequence?","cljs.core/true?","p1__26446#","p2__26447#","cljs.core.mapv","cljs.core.concat","cljs.core/reverse","cljs.core.repeat","check-events","cljs.core.doall","iter__5523__auto__","s__26465","cljs.core/LazySeq","temp__5804__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5521__auto__","size__5522__auto__","cljs.core/count","b__26467","cljs.core/chunk-buffer","i__26466","vec__26468","cljs.core/-nth","seq__26469","first__26470","cljs.core/first","cljs.core/next","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__26464","cljs.core/chunk-rest","vec__26472","seq__26473","first__26474","cljs.core/cons","cljs.core/rest","trigger-event","ks","triggered?","cljs.core/PersistentVector","triggered-event","event?","G__26477","p1__26448#","cljs.core.filter","cljs.core/second","clear?","prevent-default-keys","G__26478","prevent-default?","p1__26449#","G__26479","G__26480","G__26481","cljs.core/chunk-first"],"sourcesContent":["(ns re-pressed.impl\n  (:require\n   [re-frame.core :as rf]\n   [goog.events :as ev]\n   ))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; Vars\n\n(def ns-root \"re-pressed.core/\")\n\n(def max-record 25)\n\n(def modifier-keys #{16 ;; shift\n                     17 ;; ctrl\n                     18 ;; alt\n                     91 ;; windows (i.e. meta) ... TODO: apple key?\n                     })\n\n\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; Util\n\n(defn ->ns-keyword [event-type]\n  (fn ns-keyword\n    ([]\n     (ns-keyword nil))\n    ([suffix]\n     (keyword\n      (str ns-root\n           event-type\n           suffix)))))\n\n\n(defn is-key?\n  [recent-key key-map]\n  (every? (fn [[k v]]\n            (= (get recent-key k)\n               v))\n          key-map))\n\n\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; Subs\n\n(defn register-subs [event-type]\n  (let [ns-keyword (->ns-keyword event-type)]\n    (rf/reg-sub\n     (ns-keyword \"-keys\")\n     (fn [db _]\n       (get-in db [(ns-keyword) :keys])))\n\n    (rf/reg-sub\n     (ns-keyword \"-event-keys\")\n     (fn [db _]\n       (get-in db [(ns-keyword) :event-keys])))\n\n    (rf/reg-sub\n     (ns-keyword \"-clear-keys\")\n     (fn [db _]\n       (get-in db [(ns-keyword) :clear-keys])))\n\n    (rf/reg-sub\n     (ns-keyword \"-always-listen-keys\")\n     (fn [db _]\n       (get-in db [(ns-keyword) :always-listen-keys])))\n\n    (when (= \"keydown\" event-type)\n      (rf/reg-sub\n       (ns-keyword \"-prevent-default-keys\")\n       (fn [db _]\n         (get-in db [(ns-keyword) :prevent-default-keys]))))\n    ))\n\n\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; Events\n\n(defn- ->set-key! [event-type]\n  (let [ns-keyword (->ns-keyword event-type)]\n    (fn set-key!\n      [{:keys [db]} [_ key-map]]\n      {:db (update-in db [(ns-keyword) :keys]\n                      (fn [key-maps]\n                        (let [keys (if key-map\n                                     (conj (or key-maps\n                                               [])\n                                           key-map)\n                                     key-maps)]\n                          keys\n                          (into []\n                                (take-last max-record keys)))))})))\n\n(defn- ->clear-keys! [event-type]\n  (let [ns-keyword (->ns-keyword event-type)]\n    (fn clear-keys!\n      [{:keys [db]} [_ key-map]]\n      {:db (assoc-in db [(ns-keyword)\n                         :keys] [])})))\n\n\n(defn prevent-default-keys!\n  [_ [_ e]]\n  (let [k (keyword\n           (str ns-root \"prevent-default\"))]\n    {k e}))\n\n\n(defn register-events [event-type]\n  (let [ns-keyword (->ns-keyword event-type)]\n\n    (rf/reg-event-fx  (ns-keyword \"-set-key\")\n                      (->set-key! event-type))\n\n    (rf/reg-event-fx (ns-keyword \"-clear-keys\")\n                     (->clear-keys! event-type))\n\n    (when (= \"keydown\" event-type)\n      (rf/reg-event-fx (ns-keyword \"-prevent-default-keys\")\n                       prevent-default-keys!))))\n\n\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;; Effects\n\n(defn register-effects [event-type]\n  (when (= \"keydown\" event-type)\n    (rf/reg-fx\n     (keyword\n      (str ns-root \"prevent-default\"))\n     (fn [e]\n       (.preventDefault e)))))\n\n\n(rf/reg-fx\n (keyword\n  (str ns-root \"keyboard-event\"))\n\n (fn [{:keys [event-type]}]\n   (register-subs event-type)\n   (register-events event-type)\n   (register-effects event-type)\n\n   (ev/listen\n      js/document\n      event-type\n      (fn [e]\n        (let [ns-keyword (->ns-keyword event-type)\n\n              e-key         (.-keyCode e)\n              modifier-key? (modifier-keys e-key)\n\n              ;; --\n              ;; thanks re-frame-10x for this snippet\n              tag-name        (.-tagName (.-target e))\n              entering-input? (contains?\n                               #{\"INPUT\"\n                                 \"SELECT\"\n                                 \"TEXTAREA\"} tag-name)\n              ;; --\n\n              hit-key {:altKey   (.-altKey e)\n                       :ctrlKey  (.-ctrlKey e)\n                       :metaKey  (.-metaKey e)\n                       :shiftKey (.-shiftKey e)\n                       :keyCode  (.-keyCode e)}\n\n              always-listen-keys @(rf/subscribe [(ns-keyword \"-always-listen-keys\")])\n              always-listen?     (some #(is-key? hit-key %) always-listen-keys)]\n\n          (when (or (and (not modifier-key?)\n                         (not entering-input?))\n                    always-listen?)\n            (rf/dispatch-sync [(ns-keyword \"-set-key\") hit-key])\n            (let [recent-keys @(rf/subscribe [(ns-keyword \"-keys\")])\n                  event-keys  @(rf/subscribe [(ns-keyword \"-event-keys\")])\n                  clear-keys  @(rf/subscribe [(ns-keyword \"-clear-keys\")])\n\n                  recent-key (last recent-keys)\n\n                  is-key-sequence? (fn [key-maps]\n                                     (every? true?\n                                             (mapv\n                                              #(is-key? %1 %2)\n                                              (concat (reverse recent-keys)\n                                                      (repeat max-record {}))\n                                              (reverse key-maps))))\n\n                  check-events (doall\n                                (for [[trigger-event\n                                       & ks] event-keys]\n                                  (let [triggered? (some is-key-sequence? ks)]\n                                    (vector trigger-event triggered?))))\n\n                  [triggered-event\n                   event?] (some->> check-events\n                                    (filter #(true? (second %)))\n                                    first)\n\n                  clear? (some is-key-sequence? clear-keys)]\n              (when (= \"keydown\" event-type)\n                (let [prevent-default-keys @(rf/subscribe [(ns-keyword \"-prevent-default-keys\")])\n                      prevent-default?     (some #(is-key? recent-key %) prevent-default-keys)]\n                  (when prevent-default?\n                    (rf/dispatch-sync [(ns-keyword \"-prevent-default-keys\")\n                                       e]))))\n\n              (cond\n                clear?\n                (rf/dispatch-sync [(ns-keyword \"-clear-keys\")])\n\n                (and event?)\n                (rf/dispatch-sync (conj triggered-event\n                                        e\n                                        recent-keys))\n\n                :else nil))))))))\n"],"x_google_ignoreList":[0]}